#!/bin/bash
whois "$1" | awk 'BEGIN{f="Registrant Name,Registrant Organization,Registrant Street,Registrant City,Registrant State/Province,Registrant Postal Code,Registrant Country,Registrant Phone,Registrant Phone Ext,Registrant Fax,Registrant Fax Ext,Registrant Email,Admin Name,Admin Organization,Admin Street,Admin City,Admin State/Province,Admin Postal Code,Admin Country,Admin Phone,Admin Phone Ext,Admin Fax,Admin Fax Ext,Admin Email,Tech Name,Tech Organization,Tech Street,Tech City,Tech State/Province,Tech Postal Code,Tech Country,Tech Phone,Tech Phone Ext,Tech Fax,Tech Fax Ext,Tech Email"; split(f,K,",")} {sub(/^[ \t]+|[ \t]+$/,"",$0); if($0~/:/){split($0,a,":"); key=a[1]; val=substr($0,length(key)+2); sub(/^[ \t]+/,"",val); data[key]=val}} END{for(i=1;i<=36;i++){k=K[i]; v=data[k]; if(k~/Street/) print k", "v" "; else if(k~/Ext/ && v=="") print k":,"; else if(k~/Ext/) print k", "v; else print k", "v}}' > "${1}.csv"
